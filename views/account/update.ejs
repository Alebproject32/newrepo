<!DOCTYPE html>

<html lang="en">
   
  <head>
       
    <meta charset="UTF-8" />
       
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
       
    <title><%= title %></title>
       
    <link rel="stylesheet" href="/css/styles.css" />
     
  </head>
   
  <body>
       
    <main>
           
      <div id="wrapper">
               
        <h1 class="account-management-h1"><%= title %></h1>

               
        <!-- Flash Messages -->
                <%- messages() %> <% if (errors) { %>        
        <ul class="notice">
                    <% errors.array().forEach(error => { %>          
          <li><%= error.msg %></li>
                    <% }) %>        
        </ul>
                <% } %>

        <!-- =================================================== -->
        <!-- 1. Name and Email Update Form -->
        <!-- =================================================== -->
        <section class="update-form-section">
          <h2>Account Update</h2>
          <p class="form-description">
            Use this form to update your first name, last name, and email
            address. All fields are required.
          </p>

          <!-- Ensure the action matches the account update processing route -->
          <form id="accountUpdateForm" action="/account/update" method="post">
            <div class="form-group">
              <label for="accountFirstname">First Name</label>
              <input
                type="text"
                name="account_firstname"
                id="accountFirstname"
                required
                value="<%= locals.account_firstname || accountData.account_firstname %>"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label for="accountLastname">Last Name</label>
              <input
                type="text"
                name="account_lastname"
                id="accountLastname"
                required
                value="<%= locals.account_lastname || accountData.account_lastname %>"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label for="accountEmail">Email Address</label>
              <input
                type="email"
                name="account_email"
                id="accountEmail"
                required
                value="<%= locals.account_email || accountData.account_email %>"
                class="form-input"
              />
            </div>

            <!-- Hidden Field for Account ID -->
            <input
              type="hidden"
              name="account_id"
              value="<%= accountData.account_id %>"
            />

            <button type="submit" class="submit-button">Update Account</button>
          </form>
        </section>

        <!-- =================================================== -->
        <!-- 2. Password Change Form -->
        <!-- =================================================== -->
        <section class="password-form-section">
          <h2>Change Password</h2>
          <p class="form-description">
            To change your password, enter a new one below. Passwords must be at
            least 12 characters long and contain at least 1 capital letter, 1
            number, and 1 special character.
          </p>

          <!-- Ensure the action matches the password update processing route -->
          <!-- Important: This form should be submitted to a different route than the previous form. -->
          <form
            id="passwordUpdateForm"
            action="/account/update-password"
            method="post"
          >
            <div class="form-group">
              <label for="accountPassword">New Password</label>
              <input
                type="password"
                name="account_password"
                id="accountPassword"
                required
                pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{12,}"
                class="form-input"
              />
            </div>

            <!-- Hidden Field for Account ID (necessary to know which account to update) -->
            <input
              type="hidden"
              name="account_id"
              value="<%= accountData.account_id %>"
            />

            <button type="submit" class="submit-button">Change Password</button>
          </form>
        </section>
      </div>
    </main>
  </body>
</html>
